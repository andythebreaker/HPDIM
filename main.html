<!DOCTYPE html>
<html>

<head>
    <title>蠻南語注音直接輸入法</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <style>
        #textmains {
            background-color: #000000;
            color: #ffffff;
            border-color: #ffffff;
            border-radius: 10px;
        }

        #textmains th,
        #textmains td {
            border-color: #ffffff;
        }

        #my_text_area {
            font-size: 30px;
        }

        #my_text_area_clone {
            background-color: lightgreen;
            margin: 0.1vh 0.1vw;
            display: flex;
            flex-wrap: wrap;
            border: 1px solid black;
            max-width: 100%;
            /* 設置最大寬度不超過父元素的寬度 */
        }

        #my_text_area_clone>div {
            font-size: 30px;
            /* 設置所有子元素的字體大小為30像素 */
        }

        #container {
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
        }

        #top {
            height: 33.33%;
            background-color: #FFC0CB;
        }

        #bottom {
            height: 66.67%;
            display: flex;
        }

        #left {
            flex: 1;
            background-color: #DDB98B;
        }

        #right {
            flex: 1;
            background-color: #00CED1;
        }

        #myT {
            border-collapse: collapse;
            width: 500px;
        }

        td {
            padding: 10px;
            text-align: center;
            border: 1px solid black;
            font-size: 20px;
            font-weight: bold;
        }

        td.spacebar {
            width: 200px;
        }

        .highlight {
            background-color: yellow;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            50% {
                background-color: white;
            }
        }

        #bool_shift_is_pressed {
            width: 5vw;
            height: 5vh;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        #top,
        #bottom,
        #left,
        #right {
            margin: 0.2vh 0.2vw;
        }

        .switch-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }

        .switch-container div {
            display: flex;
            align-items: center;
        }

        .switch {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .switch+.switch-label {
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            margin-right: 10px;
            border-radius: 20px;
            padding: 5px 10px;
            background-color: #ccc;
            color: #fff;
            transition: background-color 0.2s ease-in-out;
        }

        .switch:checked+.switch-label {
            background-color: #007bff;
        }

        .switch+.switch-label:before {
            content: "";
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease-in-out;
        }

        .switch:checked+.switch-label:before {
            transform: translateX(25px);
        }
    </style>
</head>

<body>
    <div id="container">
        <div id="top">
            <table id="myT">
                <tr>
                    <td>`</td>
                    <td>1</td>
                    <td>2</td>
                    <td>3</td>
                    <td>4</td>
                    <td>5</td>
                    <td>6</td>
                    <td>7</td>
                    <td>8</td>
                    <td>9</td>
                    <td>0</td>
                    <td>-</td>
                    <td>=</td>
                    <td>Backspace</td>
                </tr>
                <tr>
                    <td>Tab</td>
                    <td>q</td>
                    <td>w</td>
                    <td>e</td>
                    <td>r</td>
                    <td>t</td>
                    <td>y</td>
                    <td>u</td>
                    <td>i</td>
                    <td>o</td>
                    <td>p</td>
                    <td>[</td>
                    <td>]</td>
                    <td>\</td>
                </tr>
                <tr>
                    <td>Caps Lock</td>
                    <td>a</td>
                    <td>s</td>
                    <td>d</td>
                    <td>f</td>
                    <td>g</td>
                    <td>h</td>
                    <td>j</td>
                    <td>k</td>
                    <td>l</td>
                    <td>;</td>
                    <td>'</td>
                    <td>Enter</td>
                </tr>
                <tr>
                    <td>Shift</td>
                    <td>z</td>
                    <td>x</td>
                    <td>c</td>
                    <td>v</td>
                    <td>b</td>
                    <td>n</td>
                    <td>m</td>
                    <td>,</td>
                    <td>.</td>
                    <td>/</td>
                    <td>Shift</td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>Spacebar</td>
                    <td></td>
                    <td></td>
                </tr>
            </table>
        </div>
        <div id="bottom">
            <div id="left" class="pc">
                <div class="switch-container">
                    <div>
                        <input type="checkbox" id="mode1" class="switch">
                        <label for="mode1" class="switch-label">鍵盤碼</label>
                    </div>
                    <div>
                        <input type="checkbox" id="mode2" class="switch">
                        <label for="mode2" class="switch-label">英文小寫</label>
                    </div>
                    <div>
                        <input type="checkbox" id="mode3" class="switch">
                        <label for="mode3" class="switch-label">注音</label>
                    </div>
                    <div>
                        <input type="checkbox" id="mode4" class="switch">
                        <label for="mode4" class="switch-label">台語</label>
                    </div>
                </div>

                <div id="my_text_area_clone"></div>
            </div>
            <div id="right">
                <div class="container mt-5">
                    <h1 class="text-center">蠻南語注音直接輸入法</h1>
                    <table id="textmains" class="table table-bordered">
                        <thead>
                            <tr>
                                <th scope="col">白底</th>
                                <th scope="col">粉底</th>
                                <th scope="col">藍綠底</th>
                                <th scope="col">綠底(黑框)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>台語注音</td>
                                <td>鍵盤(按下會閃光)</td>
                                <td>說明欄</td>
                                <td>台語注音(有ㄉ自訂字)</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="card">
                        <div class="container mt-5">
                      
                    
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">操作注意事項</h5>
                                    <p class="card-text">
                                        選擇「鍵盤碼」、「英文小寫」、「注音」、「台語」時的操作注意事項：
                                        <ul>
                                            <li>要取消一個再選另一個，否則會出現重複字元。</li>
                                        </ul>
                                    </p>
                                </div>
                            </div>
                    
                            <div class="alert alert-info" role="alert">
                                在輸入時不要點擊文字編輯區(白區)，僅游標點擊粉色(空白)處即可。
                            </div>
                        </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        var gkcb = 1;
        var gesb = 0;
        var gbpb = 0;
        var gtmb = 0;
        var mbmd = 0;
        function comparechars(aaa, bbb, achar) {
            for (var i = 0; i < aaa.length; i++) {
                if (aaa[i] === achar) {
                    return bbb[i];
                }
            }
            // If achar is not found in kc, return null or undefined, depending on your preference.
            return '';
        }
        // Get all table cells
        const cells = document.querySelectorAll('td');

        // Add event listener for keydown event
        document.addEventListener('keydown', function (event) {
            // Get the key pressed by the user
            const key = event.key.toLowerCase();

            // Loop through all table cells
            cells.forEach(function (cell) {
                // If the table cell matches the key pressed by the user
                if (cell.innerHTML.toLowerCase() === key) {
                    // Add the "highlight" class to the table cell
                    cell.classList.add('highlight');

                    // Remove the "highlight" class from the table cell after 1 second
                    setTimeout(function () {
                        cell.classList.remove('highlight');
                    }, 1000);
                }
            });
        });
        //---
        // Create a textarea element with id "my_text_area"
        const textArea = document.createElement('textarea');
        textArea.id = 'my_text_area';

        // Set the CSS styles for the textarea
        textArea.style.width = '87%'; // Set the width to 100%
        textArea.style.height = '20vh'; // Set the height to 20vh
        textArea.style.border = 'none'; // Remove the border
        textArea.style.padding = '10px'; // Add padding
        textArea.style.boxShadow = '0px 0px 10px #ABC123'; // Add a glowing effect

        // Append the textarea element to the body element
        document.getElementById("left").appendChild(textArea);


        // Add event listener for keydown event
        document.addEventListener('keydown', function (event) {
            var kc = ["À", "1", "2", "3", "4", "5", "6", "7", "8", "9", "0", "½", "»", "Q", "W", "E", "R", "T", "Y", "U", "I", "O", "P", "Û", "Ý", "Ü", "A", "S", "D", "F", "G", "H", "J", "K", "L", "º", "Þ", "Z", "X", "C", "V", "B", "N", "M", "¼", "¾", "¿"];
            var zc = ["`", "1", "2", "3", "4", "5", "6", "7", "8", "9", "0", "-", "=", "q", "w", "e", "r", "t", "y", "u", "i", "o", "p", "[", "]", "\\", "a", "s", "d", "f", "g", "h", "j", "k", "l", ";", "'", "z", "x", "c", "v", "b", "n", "m", ",", ".", "/"];
            // var bc = ["ㄅ", "ㄉ", "ˇ", "ˋ", "ㄓ", "ˊ", " ˙", " ㄚ", "ㄞ", "ㄢ", "ㄦ", "=", " ㄆ", "ㄊ", "ㄍ", "ㄐ", "ㄔ", "ㄗ", "ㄧ", "ㄛ", "ㄟ", "ㄣ", "[", "  ", "]", "\\", " ㄇ", "ㄋ", "ㄎ", "ㄑ", "ㄕ", "ㄘ", "ㄨ", "ㄜ", "ㄠ", "ㄤ", "' ", "ㄈ", "ㄌ", "ㄏ", "ㄒ", "ㄖ", "ㄙ", "ㄩ", "ㄝ", "ㄡ", "ㄥ"];
            var bc = ["`", "ㄅ", "ㄉ", "ˇ", "ˋ", "ㄓ", "ˊ", "˙", "ㄚ", "ㄞ", "ㄢ", "ㄦ", "=", "ㄆ", "ㄊ", "ㄍ", "ㄐ", "ㄔ", "ㄗ", "ㄧ", "ㄛ", "ㄟ", "ㄣ", "[", "]", "\\", "ㄇ", "ㄋ", "ㄎ", "ㄑ", "ㄕ", "ㄘ", "ㄨ", "ㄜ", "ㄠ", "ㄤ", "'", "ㄈ", "ㄌ", "ㄏ", "ㄒ", "ㄖ", "ㄙ", "ㄩ", "ㄝ", "ㄡ", "ㄥ"];
            var nos = ["ㆠ", "ㆵ", "ㆣ", "ㆢ", "ㆡ", "ㆪ", "ㆫ", "ㆩ", "ㆧ", "ㆮ", "ㆥ", "ㆯ"];
            var nos_ = ["ㄅ", "ㄉ", "ㄍ", "ㄐ", "ㄗ", "ㄧ", "ㄨ", "ㄚ", "ㄛ", "ㄞ", "ㄝ", "ㄠ"];
            var ngeh = ["ㄬ", "ㄫ", "ㆨ", "ㆦ", "ㆤ"];
            var ngeh_ = ["ㄋ", "ㄜ", "ㄨ", "ㄛ", "ㄝ"];
            var clo = ["ㆬ", "ㆰ", "ㆱ"];
            var clo_ = ["]", "ㄚ", "ㄛ"];
            // var ot1 = ["ㆭ"];
            // var ot_1 = ["]"];
            var ot2 = ["ㆭ", "ㆲ"];
            var ot_2 = ["[", "="];
            // Get the character code of the key pressed by the user
            const charCode = event.keyCode || event.which;

            // Convert the character code to a string and append it to the textarea value
            //textArea.value += String.fromCharCode(charCode);
            if (gkcb) {
                textArea.value += String.fromCharCode(charCode);
            } else if (gesb) {
                textArea.value += comparechars(kc, zc, String.fromCharCode(charCode));
            } else if (gbpb) {
                textArea.value += comparechars(kc, bc, String.fromCharCode(charCode));
            } else if (gtmb) {
                if (comparechars(kc, zc, String.fromCharCode(charCode)) === "\\" ||
                    comparechars(kc, zc, String.fromCharCode(charCode)) === "]" ||
                    comparechars(kc, zc, String.fromCharCode(charCode)) === "'"
                ) {
                    if (mbmd === 3 &&
                        comparechars(kc, zc, String.fromCharCode(charCode)) === "]") {
                        textArea.value += comparechars(clo_, clo,
                            comparechars(kc, bc, String.fromCharCode(charCode)));
                        mbmd = 0;
                    } else if (mbmd === 2 || mbmd === 1) { mbmd = 0; } else if (mbmd === 0) {
                        if (comparechars(kc, zc, String.fromCharCode(charCode)) === "\\") { mbmd = 2; } else if (
                            comparechars(kc, zc, String.fromCharCode(charCode)) === "]") { mbmd = 3; } else if (
                            comparechars(kc, zc, String.fromCharCode(charCode)) === "'") { mbmd = 1; } else {
                            console.error("模式切換邏輯錯誤");
                        }
                    } else {
                        console.error("輸入模式錯誤");
                    }

                } else if (mbmd === 3) {
                    mbmd = 0;
                    textArea.value += comparechars(clo_, clo,
                        comparechars(kc, bc, String.fromCharCode(charCode)));
                } else if (mbmd === 2) {
                    mbmd = 0;
                    textArea.value += comparechars(ngeh_, ngeh,
                        comparechars(kc, bc, String.fromCharCode(charCode)));
                } else if (mbmd === 1) {
                    mbmd = 0;
                    textArea.value += comparechars(nos_, nos,
                        comparechars(kc, bc, String.fromCharCode(charCode)));
                } else if (mbmd === 0) {
                    mbmd = 0;
                    if (comparechars(ot_2, ot2,
                        comparechars(kc, bc, String.fromCharCode(charCode))
                    )) {
                        textArea.value += comparechars(ot_2, ot2,
                            comparechars(kc, bc, String.fromCharCode(charCode))
                        );
                    } else {
                        textArea.value += comparechars(kc, bc, String.fromCharCode(charCode));
                    }
                } else {
                    console.error("輸入階段模式錯誤!");
                }
            } else {
                console.error("模式錯誤!");
            }

            mytextareaischanged();

        });
        //---
        // Create a div element with id "bool_shift_is_pressed"
        const div_ = document.createElement('div');
        div_.id = 'bool_shift_is_pressed';

        // Set the initial background color of the div
        div_.style.backgroundColor = 'darkgray';

        // Append the div element to the body element
        document.getElementById("left").appendChild(div_);

        // Add event listeners for keydown and keyup events
        document.addEventListener('keydown', function (event) {
            // Check if the Shift key is pressed down
            if (event.shiftKey) {
                // Set the background color of the div to bright
                document.getElementById('bool_shift_is_pressed').style.backgroundColor = 'lightgray';
                console.log("Check if the Shift key is pressed down");
            }
        });

        document.addEventListener('keyup', function (event) {
            // Check if the Shift key is not pressed down
            if (!event.shiftKey) {
                // Set the background color of the div to dark
                document.getElementById('bool_shift_is_pressed').style.backgroundColor = 'darkgray';
                console.log("Check if the Shift key is not pressed down");
            }
        });
        function mytextareaischanged() {
            const textarea = document.getElementById("my_text_area");
            const textarea_clone = document.getElementById("my_text_area_clone");

            textarea_clone.innerHTML = ""; // 清空textarea clone

            // 迭代textarea的每個字符，創建新的div元素來顯示它們
            for (let i = 0; i < textarea.value.length; i++) {
                /*const char = textarea.value.charAt(i);
                const char_div = document.createElement("div");
                char_div.innerText = char;
                textarea_clone.appendChild(char_div);*/
                const char = textarea.value.charAt(i);
                const charElement = char === "ㆵ" ? createSVGElement() : createTextElement(char);
                textarea_clone.appendChild(charElement);

                function createSVGElement() {
                    const svgElement = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                    svgElement.setAttribute("viewBox", "45 -33.8 150 150");
                    svgElement.setAttribute("width", "30");
                    svgElement.setAttribute("height", "30");
                    svgElement.style.enableBackground = "new  ";
                    const pathElement = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    pathElement.setAttribute("d",
                        "M147.1,76.7c8-16.5,13-38.5,14.9-65.9c-10.2,0.6-20.8,1.4-31.9,2.4c-6.7,19.3-15.3,35.6-25.7,48.9C92.9,76.8,78.5,88.9,61.3,98.5L58.8,95C75,84.4,88.7,70.8,99.9,54.2c8.4-12.3,15.1-25.7,19.9-40.1c-7.8,0.7-15.6,1.5-23.4,2.6c-6.3,1.2-10.7,2.1-13.3,2.7c-3.5,0.9-6.2,1.9-8,2.9c-0.5,0.3-1,0.5-1.5,0.8s-0.7,0.3-0.9,0.3c-0.6,0-1.5-1.5-2.9-4.5c-1.5-3.2-2.2-5.2-2.2-5.9c0-0.2,0.2-0.4,0.7-0.7c0.5-0.2,1.2-0.5,2.1-0.7c2.1-0.5,4.4-1.7,7-3.4c2.5-1.7,4.7-4.6,6.5-8.5c2-4.8,3-8.6,3-11.3c0-2.7-2.4-5-7.2-7l1.3-3.7c11.7,1.6,17.6,5.1,17.6,10.5c0,1.3-0.5,3.2-1.5,5.8c-2.9,7-7,13-12.5,18.1C111.3,9.6,135,7.2,156,4.7c2.1-0.2,3.6-0.9,4.6-1.9c1.3-1.3,2.3-2,3-2c1.8,0,4.2,1.5,7.4,4.5c2.9,2.9,4.3,5.2,4.3,6.8c0,1.2-0.9,2.4-2.7,3.7c-1.5,0.9-2.5,2.5-2.9,4.9c-4,28-9.5,49-16.6,63.1c-1.3,2.6-2.7,5-4.2,7.1c-1.4,2.1-2.8,3.7-4.2,4.9c-2.8,2.5-6,3.8-9.7,3.8c-4.3,0-8-1.6-10.9-4.8c-2.5-2.8-3.8-6.1-3.8-9.9c0-4.3,1.6-7.9,4.8-10.8c2.8-2.5,6.1-3.8,9.9-3.8c4.3,0,7.9,1.6,10.8,4.8C146.3,75.7,146.7,76.2,147.1,76.7z M135,78.1c-2.1,0-3.8,0.8-5.1,2.3c-1.2,1.3-1.8,2.8-1.8,4.5c0,2.1,0.8,3.8,2.3,5.1c1.3,1.2,2.9,1.8,4.6,1.8c2,0,3.6-0.8,5-2.3c1.2-1.3,1.8-2.9,1.8-4.6c0-2-0.8-3.6-2.3-5C138.2,78.7,136.7,78.1,135,78.1z"
                    );
                    svgElement.appendChild(pathElement);
                    return svgElement;
                }

                function createTextElement(text) {
                    const textElement = document.createElement("div");
                    textElement.innerText = text;
                    return textElement;
                }

            }
        }
        const textarea__ = document.getElementById("my_text_area");

        textarea__.addEventListener("input", mytextareaischanged);

        /*功能描述
        本規格旨在描述實現4個開關，以分別切換4個模式，並在切換時更改4個全域變數值的功能。
        
        使用者故事
        作為一個使用者，我希望能夠使用4個開關來切換不同的模式，並且在切換時更改全域變數的值。每個開關都有一個顯示名稱，且顏色不同。
        
        功能細節
        開關介面
        有一個容器包含4個開關。
        每個開關有一個名稱，分別為："鍵盤碼"、"英文小寫"、"注音"、"台語"。
        每個開關有一個不同的顏色。
        全域變數
        創建4個全域變數分別為gkcb、gesb、gbpb、gtmb，初始值為0。
        切換開關
        當使用者切換開關時，應該觸發相應的事件。
        事件處理函數應更改相應的全域變數，將其值在0和1之間切換。
        技術細節
        使用HTML創建容器和開關，每個開關有一個標籤。
        使用CSS創建樣式，使開關看起來像按鈕，並為每個開關分配一個不同的顏色。
        使用JavaScript添加事件監聽器，當開關狀態更改時，更改相應的全域變數。*/

        document.getElementById("mode1").addEventListener("change", function () {
            gkcb = this.checked ? 1 : 0;
        });

        document.getElementById("mode2").addEventListener("change", function () {
            gesb = this.checked ? 1 : 0;
        });

        document.getElementById("mode3").addEventListener("change", function () {
            gbpb = this.checked ? 1 : 0;
        });

        document.getElementById("mode4").addEventListener("change", function () {
            gtmb = this.checked ? 1 : 0;
        });

        //這段要在JS的最後
        // Get the "鍵盤碼" switch element by its ID
        const switchElement = document.getElementById('mode4');

        // Set the "checked" property to true to enable the switch
        switchElement.checked = true;


    </script>
    <!-- Load Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNVQ8bc"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
</body>

</html>